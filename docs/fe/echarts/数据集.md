# 深入理解 ECharts 数据集：从数据到可视化的最佳实践

在数据可视化的世界里，数据的管理和展示方式直接影响到图表的灵活性和可维护性。ECharts 作为一个强大的可视化库，提供了多种方式来处理数据，其中最推荐的方式是使用 **数据集（dataset）**。本文将带你深入了解如何通过数据集来优化数据管理，并实现高效的图表展示。

## 为什么选择数据集？

在 ECharts 4 之前，数据通常是直接设置在系列（series）中。虽然这种方式简单直接，但随着数据量的增加和图表复杂度的提升，逐渐暴露出一些问题：

1. **数据和配置耦合**：数据和图表的配置混在一起，导致每次数据变化时都需要重新调整整个配置。
2. **数据复用困难**：多个系列共享同一份数据时，需要手动复制数据，增加了冗余和维护成本。
3. **数据格式限制**：传统方式对数据格式要求较高，用户需要手动处理数据格式，增加了使用门槛。

而数据集的引入，完美地解决了这些问题。通过将数据和配置分离，数据集不仅简化了数据管理，还支持多种数据格式，并且允许多个系列复用同一份数据。

## 数据集的基本使用

让我们从一个简单的例子开始，看看如何使用数据集来管理数据。

```javascript
option = {
  legend: {},
  tooltip: {},
  dataset: {
    source: [
      ['product', '2015', '2016', '2017'],
      ['Matcha Latte', 43.3, 85.8, 93.7],
      ['Milk Tea', 83.1, 73.4, 55.1],
      ['Cheese Cocoa', 86.4, 65.2, 82.5],
      ['Walnut Brownie', 72.4, 53.9, 39.1],
    ],
  },
  xAxis: { type: 'category' },
  yAxis: {},
  series: [{ type: 'bar' }, { type: 'bar' }, { type: 'bar' }],
}
```

在这个例子中，数据被放在 `dataset.source` 中，而不是直接放在 `series` 中。这样做的好处是，数据和图表配置分离，数据可以被多个系列复用。比如这里的三个柱状图系列，分别对应到 `dataset.source` 中的不同年份数据。

## 数据格式的灵活性

ECharts 的数据集支持多种常见的数据格式，包括二维数组和对象数组。你可以根据实际需求选择最适合的格式。

### 二维数组

二维数组是最常见的数据格式，适合大多数场景。每一行代表一个数据项，每一列代表一个维度。

```javascript
dataset: {
  source: [
    ['product', '2015', '2016', '2017'],
    ['Matcha Latte', 43.3, 85.8, 93.7],
    ['Milk Tea', 83.1, 73.4, 55.1],
    ['Cheese Cocoa', 86.4, 65.2, 82.5],
    ['Walnut Brownie', 72.4, 53.9, 39.1],
  ]
}
```

### 对象数组

对象数组的格式更贴近 JSON 数据结构，适合处理复杂的数据关系。

```javascript
dataset: {
  dimensions: ['product', '2015', '2016', '2017'],
  source: [
    { product: 'Matcha Latte', '2015': 43.3, '2016': 85.8, '2017': 93.7 },
    { product: 'Milk Tea', '2015': 83.1, '2016': 73.4, '2017': 55.1 },
    { product: 'Cheese Cocoa', '2015': 86.4, '2016': 65.2, '2017': 82.5 },
    { product: 'Walnut Brownie', '2015': 72.4, '2016': 53.9, '2017': 39.1 }
  ]
}
```

这种格式更具可读性，尤其是在处理复杂数据时，能够更直观地展示数据的结构。

## 数据到图形的映射

数据集的强大之处在于它允许你灵活地将数据映射到图形元素上。通过 `series.encode` 属性，你可以指定数据的维度如何映射到坐标轴、提示框、标签等。

### 基本映射

```javascript
series: [
  {
    type: 'bar',
    encode: {
      x: 'amount',
      y: 'product',
    },
  },
]
```

在这个例子中，`amount` 列被映射到 X 轴，`product` 列被映射到 Y 轴。通过这种方式，你可以轻松地控制数据如何展示在图表中。

### 复杂映射

对于更复杂的场景，你可以指定多个维度进行映射。例如，在气泡图中，你可以将某一列的数据映射为气泡的大小。

```javascript
visualMap: {
  dimension: 2, // 指向第三列
  min: 2,
  max: 15,
  inRange: {
    symbolSize: [5, 60]
  }
}
```

通过 `visualMap`，你可以将数据的数值范围映射到视觉元素的大小、颜色等属性上，进一步增强图表的表现力。

## 多个数据集的使用

在一些复杂的场景中，你可能需要使用多个数据集。ECharts 支持同时定义多个数据集，并通过 `series.datasetIndex` 来指定系列使用哪个数据集。

```javascript
dataset: [
  { source: [...] }, // dataset 0
  { source: [...] }, // dataset 1
  { source: [...] }  // dataset 2
],
series: [
  { datasetIndex: 2, type: 'bar' },
  { datasetIndex: 1, type: 'line' }
]
```

这种方式非常适合处理多维度、多来源的数据，能够让图表更加灵活和多样化。

## 数据集的局限性

虽然数据集为数据管理带来了极大的便利，但并不是所有图表都支持数据集。目前，支持数据集的图表类型包括：`line`、`bar`、`pie`、`scatter`、`effectScatter`、`parallel`、`candlestick`、`map`、`funnel`、`custom`。对于一些特殊的图表类型，如 `treemap`、`graph`、`lines`，仍然需要使用传统的 `series.data` 方式。

此外，对于超大数据量的场景，数据集的性能可能会受到影响。在这种情况下，建议使用 `appendData` 进行增量加载。

## 总结

ECharts 的数据集功能为数据可视化带来了极大的灵活性和便利性。通过将数据和配置分离，数据集不仅简化了数据管理，还支持多种数据格式和复杂的映射方式，极大地提升了图表的可维护性和扩展性。

无论是处理简单的柱状图，还是复杂的多维数据展示，数据集都能帮助你轻松应对。如果你还在使用传统的 `series.data` 方式，不妨尝试一下数据集，体验它带来的高效和便捷。
