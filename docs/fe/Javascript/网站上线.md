# 网站上线

## 1. 购买服务器

https://www.aliyun.com/1111/pintuan-share?ptCode=MTM1MTU5Njk5ODE4NTg4M3x8MTE0fDE%3D&userCode=z70bsswo

- [**点击这里**](https://www.aliyun.com/1111/pintuan-share?ptCode=MTM1MTU5Njk5ODE4NTg4M3x8MTE0fDE%3D&userCode=z70bsswo) 注册阿里云用户以及购买服务器  

  -- 可以选择支付宝登录，登录之后有提示关联/注册阿里云账户，然后根据提示注册并完成**实名认证**。

- 选择对应的云服务器产品购买

  -- 双11阿里云新用户有很大优惠，1年服务器/3年服务器都比较划算。

  -- 可以参照**上课视频**，学习怎样购买流程以及各项选项，了解各项参数的意思。

- 了解阿里云控制台

  -- 控制台管理购买的服务器

  -- 启动、停止、重置等操作



## 2. 服务器工具的安装



### shell工具

-- 用于连接远程服务器，黑窗口界面。

-- 本课程使用 **finalshell**，在教案文件中有安装包，需要先行安装。**使用教程参照视频**。

-- 别的shell工具也可以，使用上都差不多，前提是你自己会安装。



### FTP工具

-- 用于将电脑中文件上传到服务器对应位置，可视化的界面。

-- 本课程使用 **FlashFXP**，在教案文件中有绿色包，解压直接用不用安装。**使用教程参照视频**。

-- 别的FTP工具也可以，使用上也差不多，前提是你自己会安装。







## 3. 页面上线

确保是cenos系统  以及 自定义密码

[![Bg3eBR.png](https://s1.ax1x.com/2020/11/04/Bg3eBR.png)](https://imgchr.com/i/Bg3eBR)

### 上传网页文件



--   FTP工具连接服务器，找到 **/usr/share/nginx/html** 目录，讲网页文件放入这里，该目录下必须有一个 **index.html** 的网页文件，如果你写项目的时候主页名字不是index，必须换成index。

[![BgZ7kQ.png](https://s1.ax1x.com/2020/11/04/BgZ7kQ.png)](https://imgchr.com/i/BgZ7kQ)



[![BgZHYj.png](https://s1.ax1x.com/2020/11/04/BgZHYj.png)](https://imgchr.com/i/BgZHYj)





[![BgZz0U.png](https://s1.ax1x.com/2020/11/04/BgZz0U.png)](https://imgchr.com/i/BgZz0U)



[![BgZrwD.png](https://s1.ax1x.com/2020/11/04/BgZrwD.png)](https://imgchr.com/i/BgZrwD)





### 安装nginx

-- shell连接到服务器，运行命令`yum install nginx`（如果你不是跟着视频教程选购的服务器，首选确保你服务器是centOS系统，或者使用你服务器能用的安装命令安装）。

-- 安装完成之后，运用命令 `service nginx start`，启动nginx。出现 *Redirecting to /bin/systemctl start nginx.service* 代表启动成功。

[![Bge9k4.png](https://s1.ax1x.com/2020/11/04/Bge9k4.png)](https://imgchr.com/i/Bge9k4)



[![BgeCtJ.png](https://s1.ax1x.com/2020/11/04/BgeCtJ.png)](https://imgchr.com/i/BgeCtJ)





[![BgeZnK.png](https://s1.ax1x.com/2020/11/04/BgeZnK.png)](https://imgchr.com/i/BgeZnK)



[![Bgem7D.png](https://s1.ax1x.com/2020/11/04/Bgem7D.png)](https://imgchr.com/i/Bgem7D)



[![BgtxuF.png](https://s1.ax1x.com/2020/11/04/BgtxuF.png)](https://imgchr.com/i/BgtxuF)





[![BgeaNQ.png](https://s1.ax1x.com/2020/11/04/BgeaNQ.png)](https://imgchr.com/i/BgeaNQ)



### 开放80端口

--   回到阿里云控制台，找到当前实例安装组，添加80端口安装组，**具体操作参照视频教程**。

[![BgeA6x.png](https://s1.ax1x.com/2020/11/04/BgeA6x.png)](https://imgchr.com/i/BgeA6x)





[![BgeEX6.png](https://s1.ax1x.com/2020/11/04/BgeEX6.png)](https://imgchr.com/i/BgeEX6)



[![Bh3DmD.png](https://s1.ax1x.com/2020/11/06/Bh3DmD.png)](https://imgchr.com/i/Bh3DmD)





CICD

- 服务器创建密钥并关机绑定
- 连接 finalShell 公钥登录（导入私钥）
- 新建 .github / workflow 文件夹下面 后缀 yml 文件

```yml
name: 打包应用并上传腾讯云

on:
    push:
        branches:
            - master

jobs:
    build:
        # runs-on 指定job任务运行所需要的虚拟机环境(必填字段)
        runs-on: ubuntu-latest
        steps:
            # 获取源码
            - name: 迁出代码
              # 使用action库  actions/checkout获取源码
              uses: actions/checkout@master

            # 安装Node10
            - name: 安装node.js
              # 使用action库  actions/setup-node安装node
              uses: actions/setup-node@v1
              with:
                  node-version: 14.0.0

            # 安装依赖
            - name: 安装依赖
              run: npm install

            # 打包
            - name: 打包
              run: npm run build

            # 上传阿里云
            - name: 发布到腾讯云
              uses: easingthemes/ssh-deploy@v2.1.1
              env:
                  # 私钥
                  SSH_PRIVATE_KEY: ${{ secrets.PRIVATE_KEY }}
                  # scp参数
                  ARGS: '-avzr --delete'
                  # 源目录
                  SOURCE: 'dist'
                  # 服务器ip：换成你的服务器IP
                  REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
                  # 用户
                  REMOTE_USER: 'root'
                  # 目标地址
                  TARGET: '/www/wwwroot'
```

- 到 settings / secrets 新建 两个 secrets  `secrets.PRIVATE_KEY：私钥   secrets.REMOTE_HOST：服务器IP `

  