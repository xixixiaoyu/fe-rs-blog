# 初识 Nest：从零开始理解核心概念

在后端开发的世界里，Nest 是一个非常流行的框架，它的设计灵感来源于 Java 的 Spring 框架。对于初学者来说，Nest 的概念可能有点复杂，但只要理解了这些核心概念，后续的学习和开发就会变得轻松许多。今天我们就来一起梳理一下 Nest 的核心概念，帮助你打下坚实的基础。

## 路由与控制器

在后端开发中，路由是我们通过不同的 URL 来访问不同接口的方式。比如：

- `/user/create`：创建用户
- `/user/list`：获取用户列表
- `/book/create`：创建书籍
- `/book/list`：获取书籍列表

这些路由在 **Controller**（控制器）中声明。控制器的主要职责是处理路由请求，并解析请求参数。通过在类和方法上使用装饰器（如 `@Controller`、`@Get`、`@Post`），我们可以轻松地定义路由和处理方法。

### 处理请求参数

在处理请求时，我们需要从 URL 或请求体中获取参数。Nest 提供了多种装饰器来帮助我们完成这项工作：

- `@Param`：获取 URL 中的路径参数，比如 `/user/111` 中的 `111`。
- `@Query`：获取 URL 中的查询参数，比如 `/user/xx?id=222` 中的 `id=222`。
- `@Body`：获取 POST 请求体中的数据，比如 `/book/create` 中的 JSON 数据 `{ username: 'xxx', password: 'xxx' }`。

这些参数会被封装成 **DTO**（Data Transfer Object，数据传输对象），传递给控制器中的处理方法（也叫 **handler**）。

## 业务逻辑与服务

控制器的职责是处理路由和解析请求参数，但业务逻辑的实现并不应该放在控制器中。相反，业务逻辑通常放在 **Service**（服务）中。服务负责处理具体的业务操作，比如与数据库的交互。

举个例子，`/book/create` 的业务逻辑会放在 `BookService` 中，而 `UserController` 的业务逻辑则会放在 `UserService` 中。这样，控制器和服务的职责就非常清晰了。

## 模块化设计

Nest 强调模块化设计，每个模块都包含相关的控制器和服务。通过 `@Module` 装饰器，我们可以声明一个模块，并将控制器和服务注册到模块中。

### 依赖注入与 IoC

Nest 实现了一套强大的依赖注入机制，称为 **IoC**（Inverse of Control，控制反转）。简单来说，开发者只需要声明依赖，Nest 会自动为你创建并注入这些依赖的实例。比如，如果 `UserController` 依赖于 `JwtService`，只需要通过 `@Inject` 声明依赖，Nest 会自动注入 `JwtService` 的实例。

在模块中，所有需要注入的服务都会通过 `providers` 数组声明。Nest 会将这些服务注册到 IoC 容器中，供其他模块或控制器使用。

## 面向切面编程（AOP）

在实际开发中，某些逻辑可能会跨越多个控制器，比如日志记录、权限验证等。Nest 提供了 **AOP**（Aspect Oriented Programming，面向切面编程）机制，允许我们在控制器的处理方法前后添加额外的逻辑。

Nest 中的 AOP 主要通过以下几种方式实现：

- **Middleware**：中间件，处理请求的预处理逻辑。
- **Guard**：守卫，通常用于权限验证。
- **Interceptor**：拦截器，可以在请求和响应之间添加逻辑，比如记录请求耗时。
- **Pipe**：管道，用于数据验证和转换。
- **Exception Filter**：异常过滤器，用于统一处理异常。

这些 AOP 机制可以帮助我们将通用逻辑从控制器中抽离出来，保持代码的简洁和可维护性。

## Nest CLI 工具

Nest 提供了强大的 CLI 工具，帮助我们快速创建项目和模块。比如：

- 创建新项目：`nest new project-name`
- 创建新模块：`nest generate module module-name`

通过 CLI 工具，我们可以大大提高开发效率，减少手动配置的工作量。

## 总结

通过这节内容，我们了解了 Nest 的一些核心概念：

- **Controller**：控制器，处理路由和解析请求参数。
- **Handler**：控制器中的方法，用于处理具体的路由请求。
- **Service**：服务，负责业务逻辑的实现。
- **DTO**：数据传输对象，用于封装请求体中的数据。
- **Module**：模块，包含控制器和服务。
- **Entity**：实体，封装数据库表的结构。
- **IoC**：控制反转，Nest 的依赖注入机制。
- **AOP**：面向切面编程，处理跨多个控制器的通用逻辑。
- **Nest CLI**：用于快速创建项目和模块的命令行工具。

这些概念是 Nest 框架的基础，理解它们后，你就能更好地掌握 Nest 的开发流程。接下来，我们会深入学习这些概念，并通过实际项目来巩固所学的知识。
