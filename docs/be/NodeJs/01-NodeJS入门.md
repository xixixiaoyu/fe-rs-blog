# Nodejs

## ä»‹ç»

### 1. Nodejs æ˜¯ä»€ä¹ˆï¼Ÿ

Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚

å®ƒä¸æ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ‰§è¡Œ JavaScript ä»£ç çš„å·¥å…·ã€‚å·¥å…·æ˜¯æŒ‡å¯ä»¥å®‰è£…åœ¨è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„è½¯ä»¶ã€‚

å®˜æ–¹ç½‘å€ <https://nodejs.org/en/>ï¼Œä¸­æ–‡ç«™ <http://nodejs.cn/>

### 2. ä¸ºä»€ä¹ˆæµè§ˆå™¨å’Œ Node.js éƒ½å¯ä»¥è¿è¡Œ JavaScript

å› ä¸ºæµè§ˆå™¨å’Œ Node.js éƒ½å†…ç½®äº† JavaScript V8 Engineã€‚

å®ƒå¯ä»¥å°† JavaScript ä»£ç ç¼–è¯‘ä¸ºè®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„æœºå™¨ç ã€‚

![image-20211231154601524](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231154603.png)

### 3. æµè§ˆå™¨ä¸­è¿è¡Œçš„ JavaScript å’Œ Node.js ä¸­è¿è¡Œçš„ JavaScript æœ‰åŒºåˆ«å—

åœ¨å†…ç½®äº† JavaScript V8 Engine ä»¥åå®é™…ä¸Šåªèƒ½æ‰§è¡Œ ECMAScriptï¼Œå°±æ˜¯è¯­è¨€ä¸­çš„è¯­æ³•éƒ¨åˆ†ã€‚

æµè§ˆå™¨ä¸ºäº†èƒ½å¤Ÿè®© JavaScript æ“ä½œæµè§ˆå™¨çª—å£ä»¥åŠ HTML æ–‡æ¡£ï¼Œæ‰€ä»¥åœ¨ JavaScript V8 Engine ä¸­æ·»åŠ äº†æ§åˆ¶å®ƒä»¬çš„ API, å°±æ˜¯ DOM å’Œ BOM. æ‰€ä»¥ JavaScript åœ¨æµè§ˆå™¨ä¸­è¿è¡Œæ—¶æ˜¯å¯ä»¥æ§åˆ¶æµè§ˆå™¨çª—å£å¯¹è±¡å’Œ DOM æ–‡æ¡£å¯¹è±¡çš„ã€‚

å’Œæµè§ˆå™¨ä¸åŒï¼Œåœ¨ Node.js ä¸­æ˜¯æ²¡æœ‰ DOM å’Œ DOM çš„ï¼Œæ‰€ä»¥åœ¨ Node.js ä¸­ä¸èƒ½æ‰§è¡Œå’Œå®ƒä»¬ç›¸å…³çš„ä»£ç ï¼Œæ¯”å¦‚ window.alert() æˆ–è€… document.getElementById() . DOM å’Œ DOM æ˜¯æµè§ˆå™¨ç¯å¢ƒä¸­ç‰¹æœ‰çš„ã€‚åœ¨ Node.js ä¸­ï¼Œä½œè€…å‘å…¶ä¸­æ·»åŠ äº†å¾ˆå¤šç³»ç»Ÿçº§åˆ«çš„ APIï¼Œæ¯”å¦‚å¯¹æ“ä½œç³»ç»Ÿä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è¿›è¡Œæ“ä½œã€‚è·å–æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ç³»ç»Ÿå†…å­˜æ€»é‡æ˜¯å¤šå°‘ï¼Œç³»ç»Ÿä¸´æ—¶ç›®å½•åœ¨å“ªï¼Œå¯¹ç³»ç»Ÿçš„è¿›ç¨‹è¿›è¡Œæ“ä½œç­‰ç­‰ã€‚

![image-20211231154852682](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231155029.png)

JavaScript è¿è¡Œåœ¨æµè§ˆå™¨ä¸­æ§åˆ¶çš„æ˜¯æµè§ˆå™¨çª—å£å’Œ DOM æ–‡æ¡£ã€‚

JavaScript è¿è¡Œåœ¨ Node.js ä¸­ æ§åˆ¶çš„æ“ä½œç³»ç»Ÿçº§åˆ«çš„å†…å®¹ï¼Œå¦‚å†…å­˜ã€ç¡¬ç›˜ã€ç½‘ç»œã€‚

![image-20211231155025486](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231155027.png)

### 4. ä¸ºä»€ä¹ˆæµè§ˆå™¨ä¸­çš„ JavaScript ä¸èƒ½æ§åˆ¶ç³»ç»Ÿçº§åˆ«çš„ API ?

æµè§ˆå™¨æ˜¯è¿è¡Œåœ¨ç”¨æˆ·çš„æ“ä½œç³»ç»Ÿä¸­çš„ï¼Œå¦‚æœèƒ½æ§æ§åˆ¶ç³»ç»Ÿçº§åˆ«çš„ API å°±ä¼šå­˜åœ¨å®‰å…¨é—®é¢˜ã€‚

Node.js æ˜¯è¿è¡Œåœ¨è¿œç¨‹çš„æœåŠ¡å™¨ä¸­çš„ï¼Œè®¿é—®çš„æ˜¯æœåŠ¡å™¨ç³»ç»Ÿ APIï¼Œä¸å­˜åœ¨è¿™æ–¹é¢çš„å®‰å…¨é—®é¢˜ã€‚

### 5. Node.js èƒ½å¤Ÿåšä»€ä¹ˆ

æˆ‘ä»¬é€šå¸¸ä½¿ç”¨å®ƒæ¥æ„å»ºæœåŠ¡å™¨ç«¯åº”ç”¨å’Œåˆ›å»ºå‰ç«¯å·¥ç¨‹åŒ–å·¥å…·ã€‚

JavaScript è¿è¡Œåœ¨æµè§ˆå™¨ä¸­æˆ‘ä»¬å°±å«å®ƒå®¢æˆ·ç«¯ JavaScriptã€‚

JavaScript è¿è¡Œåœ¨ Node.js ä¸­æˆ‘ä»¬å°±å«å®ƒæœåŠ¡å™¨ç«¯ JavaScriptã€‚

**åº”ç”¨åœºæ™¯**

- æ“ä½œæ•°æ®åº“æä¾› API æœåŠ¡
- ç½‘é¡µèŠå¤©å®¤
- åŠ¨æ€ç½‘ç«™, ä¸ªäººåšå®¢, è®ºå›, å•†åŸç­‰
- å‰ç«¯é¡¹ç›®æ‰“åŒ…(webpack, gulp)
- æ›´é€‚åˆ IO å¯†é›†å‹é«˜å¹¶å‘è¯·æ±‚ä»»åŠ¡
- Node. js åšä¸ºä¸­é—´å±‚ï¼Œåç«¯çš„ Web æœåŠ¡ï¼Œä¾‹å¦‚æœåŠ¡å™¨ç«¯çš„è¯·æ±‚ï¼ˆçˆ¬è™«ï¼‰ï¼Œä»£ç†è¯·æ±‚ï¼ˆè·¨åŸŸï¼‰

![image-20220125160248635](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/image-20220125160248635.png)

### 6.Nodejs æ¶æ„

![image-20220125124249716](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/image-20220125124249716.png)

#### Natives modules

- å½“å‰å±‚å†…å®¹ç”± JS å®ç°
- æä¾›åº”ç”¨ç¨‹åºå¯ç›´æ¥è°ƒç”¨åº“ï¼Œä¾‹å¦‚ fs ã€ pathã€http ç­‰
- JS è¯­è¨€æ— æ³•ç›´æ¥æ“ä½œåº•å±‚ç¡¬ä»¶è®¾ç½®

#### Builtin modulesâ€œèƒ¶æ°´å±‚â€

![image-20220125131036451](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/image-20220125131036451.png)

åº•å±‚

- V8ï¼šæ‰§è¡Œ JS ä»£ç ï¼Œæä¾›æ¡¥æ¢æ¥å£
- Libuvï¼šäº‹ä»¶å¾ªç¯ã€äº‹ä»¶é˜Ÿåˆ—ã€å¼‚æ­¥ lO
- ç¬¬ä¸‰æ–¹æ¨¡å—ï¼šzlib ã€ httpã€c-ares ç­‰

![image-20220125125927477](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/image-20220125125927477.png)

## Node.js å¼‚æ­¥ç¼–ç¨‹

### 1.CPU ä¸å­˜å‚¨å™¨

ç›®æ ‡: äº†è§£ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ CPU å’Œå­˜å‚¨å™¨èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨æˆ–è€…è¯´æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²

CPUï¼š

- ä¸­å¤®å¤„ç†å™¨ï¼Œè®¡ç®—æœºæ ¸å¿ƒéƒ¨ä»¶ï¼Œè´Ÿè´£è¿ç®—å’ŒæŒ‡ä»¤è°ƒç”¨ã€‚
- å¼€å‘è€…ç¼–å†™çš„ JavaScript ä»£ç åœ¨è¢«ç¼–è¯‘ä¸ºæœºå™¨ç ä»¥åå°±æ˜¯é€šè¿‡ CPU æ‰§è¡Œçš„ã€‚

å­˜å‚¨å™¨

- å†…å­˜ï¼šç”¨äºä¸´æ—¶å­˜å‚¨æ•°æ®ï¼Œæ–­ç”µåæ•°æ®ä¸¢å¤±ã€‚ç”±äºæ•°æ®è¯»å†™é€Ÿåº¦å¿«ï¼Œè®¡ç®—æœºä¸­çš„åº”ç”¨éƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿è¡Œçš„ã€‚
- ç£ç›˜ï¼šç”¨äºæŒä¹…å­˜å‚¨æ•°æ®ï¼Œæ–­ç”µåæ•°æ®ä¸ä¸¢å¤±ã€‚å†…éƒ¨æœ‰ç£å¤´ä¾é é©¬è¾¾è½¬åŠ¨åœ¨ç›˜ç‰‡ä¸Šè¯»å†™æ•°æ®, é€Ÿåº¦ æ¯”å†…å­˜æ…¢ã€‚

è®¡ç®—æœºåº”ç”¨ç¨‹åºåœ¨æ²¡æœ‰è¿è¡Œæ—¶æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„ï¼Œå½“æˆ‘ä»¬å¯åŠ¨åº”ç”¨ç¨‹åºåï¼Œåº”ç”¨ç¨‹åºä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ è¿è¡Œï¼Œåº”ç”¨ç¨‹åºä¸­çš„æŒ‡ä»¤ä¼šè¢«ä¸­å¤®å¤„ç†å™¨ CPU æ¥æ‰§è¡Œã€‚

### 2.ä»€ä¹ˆæ˜¯ I/O

I å°±æ˜¯ Input è¡¨ç¤ºè¾“å…¥ï¼ŒO å°±æ˜¯ Output è¡¨ç¤ºè¾“å‡ºï¼ŒI/O æ“ä½œå°±æ˜¯è¾“å…¥è¾“å‡ºæ“ä½œã€‚ä»€ä¹ˆæ ·çš„æ“ä½œå±äº I/O æ“ä½œå‘¢ ?

![image-20220125131724637](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/image-20220125131724637.png)

æ¯”å¦‚æ•°æ®åº“çš„è¯»å†™æ“ä½œå°±æ˜¯ I/O æ“ä½œã€‚

å› ä¸ºæ•°æ®åº“æ–‡ä»¶æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„ï¼Œè€Œæˆ‘ä»¬ç¼–å†™çš„ç¨‹åºæ˜¯è¿è¡Œåœ¨å†…å­˜ä¸­çš„ã€‚

å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥æ•°æ®åº“å¯¹äºå†…å­˜æ¥è¯´å°±æ˜¯è¾“å‡ºã€‚

æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®å°±æ˜¯å°†ç£ç›˜ä¸­çš„æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­ï¼Œå¯¹äºå†…å­˜æ¥è¯´å°±æ˜¯è¾“å…¥ã€‚

### 3.I/O æ¨¡å‹

ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼ˆå°†ç£ç›˜ä¸­çš„æ–‡ä»¶å†…å®¹è¯»å–åˆ°å†…å­˜ä¸­ï¼‰ï¼Œç”±äºç£ç›˜çš„è¯»å†™é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼ŒæŸ¥è¯¢å†…å®¹è¶Šå¤šèŠ±è´¹æ—¶é—´è¶Šå¤šã€‚

æ— è®º I/O æ“ä½œéœ€è¦èŠ±è´¹å¤šå°‘æ—¶é—´ï¼Œåœ¨ I/O æ“ä½œæ‰§è¡Œå®Œæˆåï¼ŒCPU éƒ½æ˜¯éœ€è¦è·å–åˆ°æ“ä½œç»“æœçš„ã€‚

é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼ŒCPU åœ¨å‘å‡º I/O æ“ä½œæŒ‡ä»¤åæ˜¯å¦è¦ç­‰å¾… I/O æ“ä½œæ‰§è¡Œå®Œæˆå‘¢ ?

è¿™å°±æ¶‰åŠåˆ° I/O æ“ ä½œæ¨¡å‹äº†ï¼ŒI/O æ“ä½œçš„æ¨¡å‹æœ‰ä¸¤ç§ï¼š

1. ç¬¬ä¸€ç§æ˜¯ CPU ç­‰å¾… I/O æ“ä½œæ‰§è¡Œå®Œæˆè·å–åˆ°æ“ä½œç»“æœåå†å»æ‰§è¡Œå…¶ä»–æŒ‡ä»¤ï¼Œè¿™æ˜¯åŒæ­¥ I/O æ“ä½œ (é˜»å¡ I/O)ã€‚
2. ç¬¬äºŒç§æ˜¯ CPU ä¸ç­‰å¾… I/O æ“ä½œæ‰§è¡Œå®Œæˆï¼ŒCPU åœ¨å‘å‡º I/O æŒ‡ä»¤åï¼Œå†…å­˜å’Œç£ç›˜å¼€å§‹å·¥ä½œï¼ŒCPU ç»§ç»­æ‰§è¡Œå…¶ä»–æŒ‡ä»¤ã€‚å½“ I/O æ“ä½œå®Œæˆåå†é€šçŸ¥ CPU I/O æ“ä½œçš„ç»“æœæ˜¯ä»€ä¹ˆã€‚è¿™æ˜¯å¼‚æ­¥ I/O æ“ä½œ (éé˜»å¡ I/O) ã€‚

åŒæ­¥ I/O åœ¨ä»£ç ä¸­çš„è¡¨ç°å°±æ˜¯ä»£ç æš‚åœæ‰§è¡Œç­‰å¾… I/O æ“ä½œï¼ŒI/O æ“ä½œæ‰§è¡Œå®Œæˆåå†æ‰§è¡Œåç»­ä»£ç ã€‚

å¼‚æ­¥ I/O åœ¨ä»£ç ä¸­çš„è¡¨ç°å°±æ˜¯ä»£ç ä¸æš‚åœæ‰§è¡Œï¼ŒI/O æ“ä½œåé¢çš„ä»£ç å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œå½“ I/O æ“ä½œæ‰§è¡Œå®Œæˆåé€šè¿‡å›è°ƒå‡½æ•°çš„æ–¹å¼é€šçŸ¥ CPUï¼Œè¯´ I/O æ“ä½œå·²ç»å®Œæˆäº†ï¼ŒåŸºäº I/O æ“ä½œç»“æœçš„å…¶ä»–æ“ä½œå¯ä»¥æ‰§è¡Œäº† (é€šçŸ¥ CPU è°ƒç”¨å›è°ƒå‡½æ•°)ã€‚

åŒæ­¥ I/O å’Œ å¼‚æ­¥ I/O åŒºåˆ«å°±æ˜¯æ˜¯å¦ç­‰å¾… I/O ç»“æœã€‚

Nodejs å•çº¿ç¨‹é…åˆäº‹ä»¶é©±åŠ¨æ¶æ„åŠ libuv å®ç°çš„å°±æ˜¯å¼‚æ­¥éé˜»å¡ I/O æ¨¡å‹ã€‚

```js
const fs = require("fs");

fs.readFile("./x.txt", "utf-8", function (error, data) {
  console.log(data);
});
console.log("Hello");
```

```js
const fs = require("fs");

const data = fs.readFileSync("./y.txt", { encoding: "utf-8" });
console.log(data);
```

### 4.è¿›ç¨‹ä¸çº¿ç¨‹

æ¯å½“æˆ‘ä»¬è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œæ“ä½œç³»ç»Ÿéƒ½ä¼šåˆ›å»ºè¯¥åº”ç”¨ç¨‹åºçš„å®ä¾‹å¯¹è±¡

è¯¥å®ä¾‹å¯¹è±¡å°±æ˜¯åº”ç”¨ç¨‹åºçš„è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿä¼šæŒ‰ç…§è¿›ç¨‹ä¸ºå•ä½ä¸ºåº”ç”¨ç¨‹åºåˆ†é…èµ„æºï¼Œæ¯”å¦‚å†…å­˜ï¼Œè¿™æ ·ç¨‹åºæ‰èƒ½å¤Ÿåœ¨è®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿä¸­è¿è¡Œèµ·æ¥ã€‚

![image-20220125163814040](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/image-20220125163814040.png)

çº¿ç¨‹è¢«åŒ…è£¹åœ¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ã€‚

ä¸€æ¡çº¿ç¨‹æŒ‡çš„å°±æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”ç”¨ç¨‹åºè¦åšçš„äº‹æƒ…éƒ½å­˜å‚¨åœ¨çº¿ç¨‹ä¹‹ä¸­ã€‚å¯ä»¥è¿™æ ·è®¤ä¸ºï¼Œä¸€æ¡çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªå¾…åŠåˆ—è¡¨ï¼Œ ä¾› CPU æ‰§è¡Œã€‚

![image-20220125164005013](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/image-20220125164005013.png)

### 5.JS å•çº¿ç¨‹ OR å¤šçº¿ç¨‹ ?

åœ¨ Node.js ä»£ç è¿è¡Œç¯å¢ƒä¸­ï¼Œå®ƒä¸º JavaScript ä»£ç çš„æ‰§è¡Œæä¾›äº†ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œé€šå¸¸æˆ‘ä»¬æ‰€è¯´çš„å•çº¿ç¨‹æŒ‡çš„å°±æ˜¯è¿™ä¸ªä¸»çº¿ç¨‹ã€‚

ä¸»çº¿ç¨‹ç”¨æ¥æ‰§è¡Œæ‰€æœ‰çš„åŒæ­¥ä»£ç ã€‚ä½†æ˜¯ Node.js ä»£ç è¿è¡Œç¯å¢ƒæœ¬èº«æ˜¯ç”± C++ å¼€å‘ çš„ï¼Œåœ¨ Node.js å†…éƒ¨å®ƒä¾èµ–äº†ä¸€ä¸ªå«åš libuv çš„ c++ åº“ã€‚

åœ¨è¿™ä¸ªåº“ä¸­å®ƒç»´æŠ¤äº†ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œé»˜è®¤æƒ…å†µä¸‹ åœ¨è¿™ä¸ªçº¿ç¨‹æ± ä¸­å­˜å‚¨äº† 4 ä¸ªçº¿ç¨‹ï¼ŒJavaScript ä¸­çš„å¼‚æ­¥ä»£ç å°±æ˜¯åœ¨è¿™äº›çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œæ‰€ä»¥è¯´ JavaScript ä»£ç çš„è¿è¡Œä¾é äº†ä¸æ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ JavaScript æœ¬è´¨ä¸Šè¿˜æ˜¯å¤šçº¿ç¨‹çš„ã€‚

![image-20220125165418432](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/image-20220125165418432.png)

### 6.åŸºäºå›è°ƒå‡½æ•°çš„å¼‚æ­¥ç¼–ç¨‹

#### 1.ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°

å›è°ƒå‡½æ•°æ˜¯æŒ‡é€šè¿‡å‡½æ•°å‚æ•°çš„æ–¹å¼å°†ä¸€ä¸ªå‡½æ•°ä¼ é€’åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå‚æ•°å‡½æ•°å°±æ˜¯å›è°ƒå‡½æ•°ã€‚

```js
function A() {
  console.log("A is running");
}
function B(callback) {
  console.log("B Start");
  callback(); // A is running
  console.log("B End");
}
B(A);
```

æˆ‘ä»¬ç»å¸¸å°†å›è°ƒå‡½æ•°å†™æˆ callbackï¼Œå®é™…ä¸Šå®ƒæ˜¯ call then back çš„ç®€å†™ï¼Œå«ä¹‰æ˜¯è°ƒç”¨åè¿”å›ã€‚

å°±æ˜¯åœ¨ä¸»å‡½æ•°ä¸­è°ƒç”¨å‚æ•°å‡½æ•°ï¼Œå‚æ•°å‡½æ•°è°ƒç”¨å®Œæˆåè¿”å›ä¸»å‡½æ•°ç»§ç»­æ‰§è¡Œä¸»å‡½æ•°ä¸­çš„ä»£ç ã€‚

ä¸ºä»€ä¹ˆåœ¨ B å‡½æ•°ä¸­ä¸ç›´æ¥è°ƒç”¨ A å‡½æ•°è€Œè¦é€šè¿‡å‚æ•°çš„æ–¹å¼ä¼ é€’è¿›å» ?

é€šå¸¸åœ¨ç¼–å†™åº”ç”¨ç¨‹åºæ—¶ï¼ŒB å‡½æ•°éƒ½æ˜¯è¯­è¨€å†…éƒ¨æˆ–è€…å…¶ä»–å¼€å‘è€…å®šä¹‰å¥½çš„ï¼Œæˆ‘ä»¬çœ‹ä¸åˆ°å†…éƒ¨ä»£ç æˆ–è€…è¯´ä¸èƒ½ç›´æ¥åœ¨ä»–å†…éƒ¨ä»£ç ä¸­æ’å…¥æˆ‘ä»¬çš„ä»£ç ï¼Œè€Œæˆ‘ä»¬åˆæƒ³ä»‹å…¥ç¨‹åºçš„æ‰§è¡Œï¼Œæ­¤æ—¶å°±å¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°çš„æ–¹å¼å°†æˆ‘ä»¬çš„é€»è¾‘ä¼ é€’ç»™ B å‡½æ•°ï¼ŒB å‡½æ•°åœ¨å†…éƒ¨å†æ¥è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚

#### 2.å›è°ƒå‡½æ•°ä¼ é€’å‚æ•°

åœ¨ä¸»å‡½æ•°ä¸­è°ƒç”¨å›è°ƒå‡½æ•°æ—¶ï¼Œå¯ä»¥ä¸ºå›è°ƒå‡½æ•°ä¼ é€’å‚æ•°ã€‚

```js
function A(arg) {
  console.log("A is running");
  console.log(arg);
}
function B(callback) {
  console.log("B Start");
  callback("æˆ‘æ˜¯Bå‡½æ•°ä¼ é€’ç»™Aå‡½æ•°çš„å‚æ•°"); // A is running
  console.log("B End");
}
B(A);
```

#### 3.å›è°ƒå‡½æ•°åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­çš„åº”ç”¨

åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œå¼‚æ­¥ API æ‰§è¡Œçš„ç»“æœå°±æ˜¯é€šè¿‡å›è°ƒå‡½æ•°ä¼ é€’å‚æ•°çš„æ–¹å¼ä¼ é€’åˆ°ä¸Šå±‚ä»£ç ä¸­çš„ã€‚

```js
const fs = require("fs");
fs.readFile("./index.html", "utf-8", function (error, data) {
  if (error) console.log("å‘ç”Ÿäº†é”™è¯¯");
  console.log(data);
});
```

#### 4.å›è°ƒåœ°ç‹±

> å›è°ƒåœ°ç‹±æ˜¯å›è°ƒå‡½æ•°å¤šå±‚åµŒå¥—å¯¼è‡´ä»£ç éš¾ä»¥ç»´æŠ¤çš„é—®é¢˜ã€‚
>
> åŸºäºå›è°ƒå‡½æ•°çš„å¼‚æ­¥ç¼–ç¨‹ä¸€ä¸å°å¿ƒå°±ä¼šäº§ç”Ÿå›è°ƒåœ°ç‹±çš„é—®é¢˜ã€‚

```js
const fs = require("fs");
fs.readFile("./x.txt", "utf-8", function (error, x) {
  fs.readFile("./y.txt", "utf-8", function (error, y) {
    fs.readFile("./z.txt", "utf-8", function (error, z) {
      console.log(x);
      console.log(y);
      console.log(z);
    });
  });
});
```

```js
const x = fs.readFile("./x.txt", "utf-8");
const y = fs.readFile("./y.txt", "utf-8");
const z = fs.readFile("./z.txt", "utf-8");
console.log(x);
console.log(y);
console.log(z);
```

### 7.åŸºäº Promise çš„å¼‚æ­¥ç¼–ç¨‹

1. Promise æ¦‚è¿°

> Promise æ˜¯ JavaScript ä¸­å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è§£å†³å›è°ƒå‡½æ•°æ–¹æ¡ˆä¸­çš„å›è°ƒåœ°ç‹±é—®é¢˜ã€‚
>
> å¯ä»¥å°† Promise ç†è§£ä¸ºå®¹å™¨ï¼Œç”¨äºåŒ…è£¹å¼‚æ­¥ API çš„å®¹å™¨ï¼Œå½“å®¹å™¨ä¸­çš„å¼‚æ­¥ API æ‰§è¡Œå®Œæˆåï¼Œ
>
> Promise å…è®¸æˆ‘ä»¬åœ¨å®¹å™¨çš„å¤–é¢è·å–å¼‚æ­¥ API çš„æ‰§è¡Œç»“æœï¼Œä»è€Œé¿å…å›è°ƒå‡½æ•°åµŒå¥—ã€‚
>
> Promise ç¿»è¯‘ä¸ºæ‰¿è¯ºï¼Œè¡¨ç¤ºå®ƒæ‰¿è¯ºå¸®æˆ‘ä»¬åšä¸€äº›äº‹æƒ…ï¼Œæ—¢ç„¶å®ƒæ‰¿è‹¥äº†å®ƒå°±è¦å»åšï¼Œåšå°±ä¼šæœ‰ä¸€ä¸ªè¿‡ ç¨‹ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªç»“æœï¼Œç»“æœè¦ä¹ˆæ˜¯æˆåŠŸè¦ä¹ˆæ˜¯å¤±è´¥ã€‚
>
> æ‰€ä»¥åœ¨ Promise ä¸­æœ‰ä¸‰ç§çŠ¶æ€, åˆ†åˆ«ä¸ºç­‰å¾…(pending)ï¼ŒæˆåŠŸ(fulfilled)ï¼Œå¤±è´¥(rejected)ã€‚
>
> é»˜è®¤çŠ¶æ€ä¸ºç­‰å¾…ï¼Œç­‰å¾…å¯ä»¥å˜ä¸ºæˆåŠŸï¼Œç­‰å¾…å¯ä»¥å˜ä¸ºå¤±è´¥ã€‚
>
> çŠ¶æ€ä¸€æ—¦æ›´æ”¹ä¸å¯æ”¹å˜ï¼ŒæˆåŠŸä¸èƒ½å˜å›ç­‰å¾…ï¼Œå¤±è´¥ä¸èƒ½å˜å›ç­‰å¾…ï¼ŒæˆåŠŸä¸èƒ½å˜æˆå¤±è´¥ï¼Œå¤±è´¥ä¸èƒ½å˜ æˆæˆåŠŸã€‚

2. åŸºç¡€è¯­æ³•

```js
const fs = require("fs");
const promise = new Promise(function (resolve, reject) {
  fs.readFile("./x.txt", "utf-8", function (error, data) {
    if (error) {
      // å°†çŠ¶æ€ä»ç­‰å¾…å˜ä¸ºå¤±è´¥
      reject(error);
    } else {
      // å°†çŠ¶æ€ä»ç­‰å¾…å˜ä¸ºæˆåŠŸ
      resolve(data);
    }
  });
});
promise
  .then(function (data) {
    console.log(data);
  })
  .catch(function (error) {
    console.log(error);
  });
```

3. Promise é“¾å¼è°ƒç”¨

```js
const fs = require("fs");
function readFile(path) {
  return new Promise(function (resolve, reject) {
    fs.readFile(path, "utf-8", function (error, data) {
      if (error) return reject(error);
      resolve(data);
    });
  });
}
readFile("./x.txt")
  .then(function (x) {
    console.log(x);
    return readFile("./y.txt");
  })
  .then(function (y) {
    console.log(y);
    return readFile("./z.txt");
  })
  .then(function (z) {
    console.log(z);
  })
  .catch(function (error) {
    console.log(error);
  })
  .finally(function () {
    console.log("finally");
  });
```

4. Promise.all å¹¶å‘å¼‚æ­¥æ“ä½œ

```js
const fs = require("fs");
Promise.all([readFile("./x.txt"), readFile("./y.txt"), readFile("./z.txt")]).then(function (data) {
  console.log(data);
});
```

### 8.åŸºäºå¼‚æ­¥å‡½æ•°çš„å¼‚æ­¥ç¼–ç¨‹

Promise è™½ç„¶è§£å†³äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜ï¼Œä½†æ˜¯ä»£ç çœ‹èµ·æ¥ä»ç„¶ä¸ç®€æ´ã€‚

ä½¿ç”¨å¼‚æ­¥å‡½æ•°ç®€åŒ–ä»£ç æé«˜å¼‚æ­¥ç¼–ç¨‹ä½“éªŒã€‚

1. å¼‚æ­¥å‡½æ•°æ¦‚è¿°

```js
const fs = require("fs");
function readFile(path) {
  return new Promise(function (resolve, reject) {
    fs.readFile(path, "utf-8", function (error, data) {
      if (error) return reject(error);
      resolve(data);
    });
  });
}
async function getFileContent() {
  let x = await readFile("./x.txt");
  let y = await readFile("./y.txt");
  let z = await readFile("./z.txt");
  return [x, y, z];
}
getFileContent().then(console.log);
```

async å£°æ˜å¼‚æ­¥å‡½æ•°çš„å…³é”®å­—ï¼Œå¼‚æ­¥å‡½æ•°çš„è¿”å›å€¼ä¼šè¢«è‡ªåŠ¨å¡«å……åˆ° Promise å¯¹è±¡ä¸­ã€‚

await å…³é”®å­—åé¢åªèƒ½æ”¾ç½®è¿”å› Promise å¯¹è±¡çš„ APIã€‚

await å…³é”®å­—å¯ä»¥æš‚åœå‡½æ•°æ‰§è¡Œï¼Œç­‰å¾… Promise æ‰§è¡Œå®Œåè¿”å›æ‰§è¡Œç»“æœã€‚

await å…³é”®å­—åªèƒ½å‡ºç°åœ¨å¼‚æ­¥å‡½æ•°ä¸­ã€‚

2. util.promisify

åœ¨ Node.js å¹³å°ä¸‹ï¼Œæ‰€æœ‰å¼‚æ­¥æ–¹æ³•ä½¿ç”¨çš„éƒ½æ˜¯åŸºäºå›è°ƒå‡½æ•°çš„å¼‚æ­¥ç¼–ç¨‹ã€‚ä¸ºäº†ä½¿ç”¨å¼‚æ­¥å‡½æ•°æé«˜å¼‚æ­¥ç¼–ç¨‹ä½“éªŒï¼Œå¯ä»¥ä½¿ç”¨ util æ¨¡å—ä¸‹é¢çš„ promisify æ–¹æ³•å°†åŸºäºå›è°ƒå‡½æ•°çš„å¼‚æ­¥ API è½¬æ¢æˆè¿”å› Promise çš„ APIã€‚

```js
const fs = require("fs");
const util = require("util");
const readFile = util.promisify(fs.readFile);
async function getFileContent() {
  let x = await readFile("./x.txt", "utf-8");
  let y = await readFile("./y.txt", "utf-8");
  let z = await readFile("./z.txt", "utf-8");
  return [x, y, z];
}
getFileContent().then(console.log);
```

### 9.Event Loop æœºåˆ¶æ¦‚è¿°

1.ä¸ºä»€ä¹ˆè¦å­¦ä¹ äº‹ä»¶å¾ªç¯æœºåˆ¶

- å­¦ä¹ äº‹ä»¶å¾ªç¯å¯ä»¥è®©å¼€å‘è€…æ˜ç™½ JavaScript çš„è¿è¡Œæœºåˆ¶æ˜¯æ€ä¹ˆæ ·çš„ã€‚

  2.äº‹ä»¶å¾ªç¯æœºåˆ¶åšçš„æ˜¯ä»€ä¹ˆäº‹æƒ…ï¼Ÿ

- äº‹ä»¶å¾ªç¯æœºåˆ¶ç”¨äºç®¡ç†å¼‚æ­¥ API çš„å›è°ƒå‡½æ•°ä»€ä¹ˆæ—¶å€™å›åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚
- Node.js é‡‡ç”¨çš„æ˜¯å¼‚æ­¥ I/O æ¨¡å‹ã€‚åŒæ­¥ API åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¼‚æ­¥ API åœ¨åº•å±‚çš„ C++ ç»´æŠ¤çš„çº¿ç¨‹ä¸­ æ‰§è¡Œï¼Œå¼‚æ­¥ API çš„å›è°ƒå‡½æ•°åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚åœ¨ JavaScript åº”ç”¨è¿è¡Œæ—¶ï¼Œä¼—å¤šå¼‚æ­¥ API çš„å›è°ƒå‡½æ•° ä»€ä¹ˆæ—¶å€™èƒ½å›åˆ°ä¸»çº¿ç¨‹ä¸­è°ƒç”¨å‘¢ï¼Ÿè¿™å°±æ˜¯äº‹ä»¶å¾ªç¯æœºåˆ¶åšçš„äº‹æƒ…ï¼Œç®¡ç†å¼‚æ­¥ API çš„å›è°ƒå‡½æ•°ä»€ä¹ˆæ—¶ å€™å›åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚

  3.ä¸ºä»€ä¹ˆè¿™ç§æœºåˆ¶å«åšäº‹ä»¶å¾ªç¯ï¼Ÿ

- å› ä¸º Node.js æ˜¯äº‹ä»¶é©±åŠ¨çš„ã€‚äº‹ä»¶é©±åŠ¨å°±æ˜¯å½“ä»€ä¹ˆæ—¶å€™åšä»€ä¹ˆäº‹æƒ…ï¼Œåšçš„äº‹æƒ…å°±å®šä¹‰åœ¨å›è°ƒå‡½æ•° ä¸­ï¼Œå¯ä»¥å°†å¼‚æ­¥ API çš„å›è°ƒå‡½æ•°ç†è§£ä¸ºäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ‰€ä»¥ç®¡ç†å¼‚æ­¥ API å›è°ƒå‡½æ•°ä»€ä¹ˆæ—¶å€™å›åˆ°ä¸» çº¿ç¨‹ä¸­è°ƒç”¨çš„æœºåˆ¶å«åšäº‹ä»¶å¾ªç¯æœºåˆ¶ã€‚

### 10.Event Loop çš„å…­ä¸ªé˜¶æ®µ

äº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªå¾ªç¯ä½“ï¼Œåœ¨å¾ªç¯ä½“ä¸­æœ‰å…­ä¸ªé˜¶æ®µï¼Œåœ¨æ¯ä¸ªé˜¶æ®µä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—ï¼Œä¸åŒçš„äº‹ä»¶é˜Ÿåˆ— å­˜å‚¨äº†ä¸åŒç±»å‹çš„å¼‚æ­¥ API çš„å›è°ƒå‡½æ•°ã€‚

![image-20220125184008066](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/image-20220125184008066.png)

1. Timersï¼šç”¨äºå­˜å‚¨å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°(setInterval, setTimeout)

2. Pending callbacksï¼šæ‰§è¡Œä¸æ“ä½œç³»ç»Ÿç›¸å…³çš„å›è°ƒå‡½æ•°ï¼Œæ¯”å¦‚å¯åŠ¨æœåŠ¡å™¨ç«¯åº”ç”¨æ—¶ç›‘å¬ç«¯å£æ“ä½œçš„å›è°ƒå‡½æ•°å°±åœ¨è¿™é‡Œè°ƒç”¨ã€‚

3. Idle, prepareï¼šç³»ç»Ÿå†…éƒ¨ä½¿ç”¨ã€‚

4. IO Pollï¼šå­˜å‚¨ I/O æ“ä½œçš„å›è°ƒå‡½æ•°é˜Ÿåˆ—ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™æ“ä½œçš„å›è°ƒå‡½æ•°ã€‚

   å¦‚æœäº‹ä»¶é˜Ÿåˆ—ä¸­æœ‰å›è°ƒå‡½æ•°ï¼Œæ‰§è¡Œå®ƒä»¬ç›´åˆ°æ¸…ç©ºé˜Ÿåˆ—ã€‚

   å¦åˆ™äº‹ä»¶å¾ªç¯å°†åœ¨æ­¤é˜¶æ®µåœç•™ä¸€æ®µæ—¶é—´ä»¥ç­‰å¾…æ–°çš„å›è°ƒå‡½æ•°è¿›å…¥ï¼Œè¿™ä¸ªç­‰å¾…å–å†³äºä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š

   1. setImmediate é˜Ÿåˆ—(check é˜¶æ®µ)ä¸­å­˜åœ¨è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚
   2. timers é˜Ÿåˆ—ä¸­å­˜åœ¨è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°. åœ¨è¿™ç§æƒ…å†µä¸‹, äº‹ä»¶å¾ªç¯å°†ç§»è‡³ check é˜¶æ®µ, ç„¶åç§»è‡³ Closing callbacks é˜¶æ®µ, å¹¶æœ€ç»ˆä» timers é˜¶æ®µè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚

5. Checkï¼šå­˜å‚¨ setImmediate API çš„å›è°ƒå‡½æ•°ã€‚
6. Closing callbacksï¼šæ‰§è¡Œä¸å…³é—­äº‹ä»¶ç›¸å…³çš„å›è°ƒï¼Œä¾‹å¦‚å…³é—­æ•°æ®åº“è¿æ¥çš„å›è°ƒå‡½æ•°ç­‰ã€‚

å¾ªç¯ä½“ä¼šä¸æ–­è¿è¡Œä»¥æ£€æµ‹æ˜¯å¦å­˜åœ¨æ²¡æœ‰è°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼Œäº‹ä»¶å¾ªç¯æœºåˆ¶ä¼šæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼æ‰§è¡Œä»–ä»¬ç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºã€‚

### 11.å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡

å®ä»»åŠ¡ï¼šsetInterval, setTimeout, setImmediate, I/O

å¾®ä»»åŠ¡ï¼šPromise.then Promise.catch Promise.finally, process.nextTick

#### å¾®ä»»åŠ¡ä¸å®ä»»åŠ¡çš„åŒºåˆ«

1.  å¾®ä»»åŠ¡çš„å›è°ƒå‡½æ•°è¢«æ”¾ç½®åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå®ä»»åŠ¡çš„å›è°ƒå‡½æ•°è¢«æ”¾ç½®åœ¨å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚
2.  å¾®ä»»åŠ¡ä¼˜å…ˆçº§é«˜äºå®ä»»åŠ¡ã€‚

å½“å¾®ä»»åŠ¡äº‹ä»¶é˜Ÿåˆ—ä¸­å­˜åœ¨å¯ä»¥æ‰§è¡Œçš„å›è°ƒå‡½æ•°æ—¶ï¼Œäº‹ä»¶å¾ªç¯åœ¨æ‰§è¡Œå®Œå½“å‰é˜¶æ®µçš„å›è°ƒå‡½æ•°åä¼šæš‚åœ è¿›å…¥äº‹ä»¶å¾ªç¯çš„ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œäº‹ä»¶å¾ªç¯ä¼šç«‹å³è¿›å…¥å¾®ä»»åŠ¡çš„äº‹ä»¶é˜Ÿåˆ—ä¸­å¼€å§‹æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå½“å¾®ä»» åŠ¡é˜Ÿåˆ—ä¸­çš„å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œäº‹ä»¶å¾ªç¯å†è¿›å…¥åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µå¼€å§‹æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚

nextTick çš„ä¼˜å…ˆçº§é«˜äº microTaskï¼Œåœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œåªæœ‰ nextTick ä¸­çš„æ‰€æœ‰å›è°ƒå‡½æ•°æ‰§è¡Œå®Œæˆå æ‰ä¼šå¼€å§‹æ‰§è¡Œ microTaskã€‚

ä¸åŒé˜¶æ®µçš„å®ä»»åŠ¡çš„å›è°ƒå‡½æ•°è¢«æ”¾ç½®åœ¨äº†ä¸åŒçš„å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå®ä»»åŠ¡ä¸å®ä»»åŠ¡ä¹‹é—´æ²¡æœ‰ä¼˜å…ˆçº§çš„æ¦‚å¿µï¼Œä»–ä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯æŒ‰ç…§äº‹ä»¶å¾ªç¯çš„é˜¶æ®µé¡ºåºè¿›è¡Œçš„ã€‚

### 12.Event Loop ä»£ç è§£æ

åœ¨ Node åº”ç”¨ç¨‹åºå¯åŠ¨åï¼Œå¹¶ä¸ä¼šç«‹å³è¿›å…¥äº‹ä»¶å¾ªç¯ï¼Œè€Œæ˜¯å…ˆæ‰§è¡Œè¾“å…¥ä»£ç ï¼Œä»ä¸Šåˆ°ä¸‹å¼€å§‹æ‰§è¡Œï¼ŒåŒæ­¥ API ç«‹å³æ‰§è¡Œï¼Œå¼‚æ­¥ API äº¤ç»™ C++ ç»´æŠ¤çš„çº¿ç¨‹æ‰§è¡Œï¼Œå¼‚æ­¥ API çš„å›è°ƒå‡½æ•°è¢«æ³¨å†Œåˆ°å¯¹åº”çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚ å½“æ‰€æœ‰è¾“å…¥ä»£ç æ‰§è¡Œå®Œæˆåï¼Œå¼€å§‹è¿›å…¥äº‹ä»¶å¾ªç¯ã€‚

```js
console.log("start");
setTimeout(() => {
  console.log("setTimeout 1");
}, 0);
setTimeout(() => {
  console.log("setTimeout 2");
}, 0);
console.log("end");
// start end 1 2
```

```js
setTimeout(() => console.log("1"), 0);
setImmediate(() => console.log("2"));
function sleep(delay) {
  var start = new Date().getTime();
  while (new Date().getTime() - start < delay) {
    continue;
  }
}
sleep(1000);
// 1 2
```

```js
setTimeout(() => console.log("1"), 0);
setImmediate(() => console.log("2"));
// 2 1 æˆ– 1 2
```

```js
const fs = require("fs");
fs.readFile("./index.html", () => {
  setTimeout(() => console.log("1"), 0);
  setImmediate(() => console.log("2"));
});
// 2 1
```

```js
setTimeout(() => console.log("1"), 50);
process.nextTick(() => console.log("2"));
setImmediate(() => console.log("3"));
process.nextTick(() => console.log("4"));
// 2 4 3 1
```

```js
setTimeout(() => console.log(1));
setImmediate(() => console.log(2));
process.nextTick(() => console.log(3));
Promise.resolve().then(() => console.log(4));
(() => console.log(5))();
// 5 3 4 1 2
```

```js
process.nextTick(() => console.log(1));
Promise.resolve().then(() => console.log(2));
process.nextTick(() => console.log(3));
Promise.resolve().then(() => console.log(4));
// 1 3 2 4
```

```js
setTimeout(() => console.log("1"), 50);
process.nextTick(() => console.log("2"));
setImmediate(() => console.log("3"));
process.nextTick(() =>
  setTimeout(() => {
    console.log("4");
  }, 1000)
);
// 2 3 1 4
```

### 13.process.nextTick ä¸ setImmediate()

1. process.nextTick()

æ­¤æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¼šåœ¨äº‹ä»¶å¾ªç¯ä¹‹å‰è¢«è°ƒç”¨ã€‚

å¦‚æœä½ å¸Œæœ›å¼‚æ­¥ä»»åŠ¡å°½å¯èƒ½æ—©åœ°æ‰§è¡Œï¼Œé‚£å°±ä½¿ç”¨ process.nextTickã€‚

```js
const fs = require("fs");
function readFile(fileName, callback) {
  if (typeof fileName !== "string") {
    return callback(new TypeError("filename å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹"));
  }
  fs.readFile(filename, function (err, data) {
    if (err) return callback(err);
    return callback(null, data);
  });
}
```

æ­¤æ®µä»£ç çš„é—®é¢˜åœ¨äº readFile æ–¹æ³•æ ¹æ®ä¼ å…¥çš„å‚æ•°ç±»å‹ï¼Œcallback å¯èƒ½ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­ç›´æ¥è¢«è°ƒç”¨ï¼Œ callback ä¹Ÿå¯èƒ½åœ¨äº‹ä»¶å¾ªç¯çš„ IO è½®è¯¢é˜¶æ®µè¢«è°ƒç”¨ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„é—®é¢˜å‘ç”Ÿã€‚å¦‚ä½•ä½¿ readFile æ–¹æ³•å˜æˆå®Œå…¨å¼‚æ­¥çš„å‘¢ï¼Ÿ

```js
const fs = require("fs")
function readFile(fileName, callback) {
if (typeof fileName !== "string") {
	return process.nextTick(callback, new TypeError("filename å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»
å‹"))
}
fs.readFile(fileName, (err, data) => {
		if (err) return callback(err)
		return callback(null, data)
	})
}
```

ç»è¿‡ä»¥ä¸Šæ›´æ”¹ä»¥åï¼Œæ— è®º fileName å‚æ•°æ˜¯å¦æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œcallback éƒ½ä¸ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­ç›´æ¥è¢«è°ƒç”¨ã€‚

2. setImmediate()

setImmediate è¡¨ç¤ºç«‹å³æ‰§è¡Œï¼Œå®ƒæ˜¯å®ä»»åŠ¡ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«ä¼šæ”¾ç½®åœ¨äº‹ä»¶å¾ªç¯çš„ check é˜¶æ®µã€‚

åœ¨åº”ç”¨ä¸­å¦‚æœæœ‰å¤§é‡çš„è®¡ç®—å‹ä»»åŠ¡ï¼Œå®ƒæ˜¯ä¸é€‚åˆæ”¾åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå› ä¸ºè®¡ç®—ä»»åŠ¡ä¼šé˜»å¡ä¸»çº¿ ç¨‹ï¼Œä¸»çº¿ç¨‹ä¸€æ—¦è¢«é˜»å¡ï¼Œå…¶ä»–ä»»åŠ¡å°±éœ€è¦ç­‰å¾…ï¼Œæ‰€ä»¥è¿™ç§ç±»å‹çš„ä»»åŠ¡æœ€å¥½äº¤ç»™ç”± C++ ç»´æŠ¤çš„çº¿ç¨‹å» æ‰§è¡Œã€‚

å¯ä»¥é€šè¿‡ setImmediate æ–¹æ³•å°†ä»»åŠ¡æ”¾å…¥äº‹ä»¶å¾ªç¯ä¸­çš„ check é˜¶æ®µï¼Œå› ä¸ºä»£ç åœ¨è¿™ä¸ªé˜¶æ®µæ‰§è¡Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šé˜»å¡äº‹ä»¶å¾ªç¯ã€‚

```js
function sleep(delay) {
  var start = new Date().getTime();
  while (new Date().getTime() - start < delay) {
    continue;
  }
  console.log("ok");
}
```

```js
console.log("start");
sleep(2000);
console.log("end");
```

```js
console.log("start");
setImmediate(sleep, 2000);
console.log("end");
```

ç»“è®ºï¼šNode é€‚åˆ I/O å¯†é›†å‹ä»»åŠ¡ï¼Œä¸é€‚åˆ CPU å¯†é›†å‹ä»»åŠ¡ï¼Œå› ä¸ºä¸»çº¿ç¨‹ä¸€æ—¦é˜»å¡ï¼Œç¨‹åºå°±å¡ä½äº†ã€‚

## ç³»ç»Ÿç¯å¢ƒå˜é‡

ç³»ç»Ÿç¯å¢ƒå˜é‡æ˜¯æŒ‡åœ¨æ“ä½œç³»ç»Ÿçº§åˆ«ä¸Šå®šä¹‰çš„å˜é‡ï¼Œå˜é‡ä¸­å­˜å‚¨äº†ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€è¦çš„å‚æ•°ã€‚

![image-20211231155429238](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231155432.png)

æ¯”å¦‚åœ¨ä½¿ç”¨ webpack æ„å»ºå‰ç«¯åº”ç”¨æ—¶å°±ä½¿ç”¨åˆ°äº†ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œå› ä¸º webpack éœ€è¦æ ¹æ®ç³»ç»Ÿç¯å¢ƒå˜é‡åˆ¤æ–­å½“å‰ä¸ºå¼€å‘ç¯å¢ƒè¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œæ ¹æ®ç¯å¢ƒå†³å®šå¦‚ä½•æ„å»ºåº”ç”¨ã€‚

åœ¨å¼€å‘ç¯å¢ƒçš„æ“ä½œç³»ç»Ÿä¸­å®šä¹‰ NODE_ENV å˜é‡ï¼Œå€¼ä¸º developmentï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒçš„æ“ä½œç³»ç»Ÿä¸­å®šä¹‰ NODE_ENV å˜é‡ï¼Œå€¼ä¸º productionã€‚webpack åœ¨è¿è¡Œæ—¶é€šè¿‡ process.env.NODE_ENV è·å–å˜é‡çš„å€¼ï¼Œä»è€Œå¾—å‡ºå½“å‰ä»£ç çš„è¿è¡Œç¯å¢ƒæ˜¯ä»€ä¹ˆã€‚

ç¯å¢ƒå˜é‡ PATHï¼šç³»ç»Ÿç¯å¢ƒå˜é‡ PATH ä¸­å­˜å‚¨çš„éƒ½æ˜¯åº”ç”¨ç¨‹åºè·¯å¾„ã€‚å½“è¦æ±‚ç³»ç»Ÿè¿è¡ŒæŸä¸€ä¸ªåº”ç”¨ç¨‹åºåˆæ²¡æœ‰å‘Šè¯‰å®ƒç¨‹åºçš„å®Œæ•´è·¯å¾„æ—¶ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿä¼šå…ˆåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸­æŸ¥æ‰¾åº”ç”¨ç¨‹åºï¼Œå¦‚æœæŸ¥æ‰¾ä¸åˆ°å°±ä¼šå»ç³»ç»Ÿç¯å¢ƒå˜é‡ PATH ä¸­æŒ‡å®šçš„è·¯å¾„ä¸­æŸ¥æ‰¾ã€‚

![image-20211231155611080](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231155612.png)

## ä½¿ç”¨

### ä¸‹è½½å®‰è£…

å·¥å…·ä¸€å®šè¦åˆ°å®˜æ–¹ä¸‹è½½ï¼Œå†å²ç‰ˆæœ¬ä¸‹è½½ <https://npm.taobao.org/mirrors/node/>

![img](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231094521.png)

Nodejs çš„ç‰ˆæœ¬å·å¥‡æ•°ä¸ºå¼€å‘ç‰ˆæœ¬ï¼Œå¶æ•°ä¸ºå‘å¸ƒç‰ˆæœ¬ï¼Œ<span style="color:red">æˆ‘ä»¬é€‰æ‹©å¶æ•°å·çš„ LTS ç‰ˆæœ¬ï¼ˆé•¿æœŸç»´æŠ¤ç‰ˆæœ¬ long term serviceï¼‰</span>

![1572676490692](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231094530.png)

åŒå‡»æ‰“å¼€å®‰è£…æ–‡ä»¶ï¼Œä¸€è·¯ä¸‹ä¸€æ­¥å³å¯ ğŸ˜ï¼Œé»˜è®¤çš„å®‰è£…è·¯å¾„æ˜¯ `C:\Program Files\nodejs`

å®‰è£…å®Œæˆåï¼Œåœ¨ CMD å‘½ä»¤è¡Œçª—å£ä¸‹è¿è¡Œ `node -v`ï¼Œå¦‚æ˜¾ç¤ºç‰ˆæœ¬å·åˆ™è¯æ˜å®‰è£…æˆåŠŸï¼Œåä¹‹å®‰è£…å¤±è´¥ï¼Œé‡æ–°å®‰è£…ã€‚

![1572678177784](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231094535.png)

### åˆä½“éªŒ

#### äº¤äº’æ¨¡å¼

åœ¨å‘½ä»¤è¡Œä¸‹è¾“å…¥å‘½ä»¤ `node`ï¼Œè¿™æ—¶è¿›å…¥ nodejs çš„äº¤äº’æ¨¡å¼

![1572678681282](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231094538.png)

#### æ–‡ä»¶æ‰§è¡Œ

åˆ›å»ºæ–‡ä»¶ hello.js ï¼Œå¹¶å†™å…¥ä»£ç  console.log('hello world')ï¼Œå‘½ä»¤è¡Œè¿è¡Œ `node hello.js`

å¿«é€Ÿå¯åŠ¨å‘½ä»¤è¡Œçš„æ–¹æ³•

- åœ¨æ–‡ä»¶å¤¹ä¸Šæ–¹çš„è·¯å¾„ä¸­ï¼Œç›´æ¥è¾“å…¥ cmd å³å¯
- ä½¿ç”¨ webstorm å’Œ vscode è‡ªå¸¦çš„å‘½ä»¤è¡Œçª—å£

![1572680753835](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231094540.png)

#### VScode æ’ä»¶è¿è¡Œ

å®‰è£…æ’ä»¶ ã€code Runnerã€, æ–‡ä»¶å³é”® -> run code

![1593782861500](https://raw.githubusercontent.com/xixixiaoyu/CloundImg2/main/20211231094543.png)

#### å…¨å±€å¯¹è±¡

<span style="color:red">åœ¨ nodejs ç¯å¢ƒä¸‹ï¼Œä¸èƒ½ä½¿ç”¨ BOM å’Œ DOM ï¼Œä¹Ÿæ²¡æœ‰å…¨å±€å¯¹è±¡ windowï¼Œå…¨å±€å¯¹è±¡çš„åå­—å« global</span>

åœ¨ global å¯¹è±¡ä¸­ä¼šå­˜åœ¨ä¸€äº›å’Œ window å¯¹è±¡ä¸­åå­—ç›¸åŒä¸”ä½œç”¨ç›¸åŒçš„æ–¹æ³•

```
global.console.log
global.setInterval
global.clearInterval
global.setTimeout
global.clearTimeout
global.setImmediate
```

Nodejs å¸¸è§çš„å…¨å±€å¯¹è±¡

- \_\_filenameï¼šè¿”å›æ­£åœ¨æ‰§è¡Œè„šæœ¬æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
- \_\_dirnameï¼šè¿”å›æ­£åœ¨æ‰§è¡Œè„šæœ¬æ‰€åœ¨ç›®å½•
- timer ç±»å‡½æ•°ï¼šæ‰§è¡Œé¡ºåºä¸äº‹ä»¶å¾ªç¯é—´çš„å…³ç³»
- processï¼šæä¾›ä¸å½“å‰è¿›ç¨‹äº’åŠ¨çš„æ¥å£
- requireï¼šå®ç°æ¨¡å—çš„åŠ è½½
- moduleã€exportsï¼šå¤„ç†æ¨¡å—çš„å¯¼å‡º

### Buffer(ç¼“å†²å™¨)

#### ä»‹ç»

Buffer æ˜¯ä¸€ä¸ªå’Œæ•°ç»„ç±»ä¼¼çš„å¯¹è±¡ï¼Œä¸åŒæ˜¯ Buffer æ˜¯ä¸“é—¨ç”¨æ¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®çš„

#### ç‰¹ç‚¹

- å¤§å°å›ºå®šï¼šåœ¨åˆ›å»ºæ—¶å°±ç¡®å®šäº†ï¼Œä¸”æ— æ³•è°ƒæ•´
- æ€§èƒ½è¾ƒå¥½ï¼šç›´æ¥å¯¹è®¡ç®—æœºçš„å†…å­˜è¿›è¡Œæ“ä½œ
- æ¯ä¸ªå…ƒç´ å¤§å°ä¸º 1 å­—èŠ‚ ï¼ˆbyteï¼‰

#### æ“ä½œ

##### åˆ›å»º Buffer

- ç›´æ¥åˆ›å»º Buffer.alloc

- ä¸å®‰å…¨åˆ›å»º Buffer.allocUnsafe

- é€šè¿‡æ•°ç»„å’Œå­—ç¬¦ä¸²åˆ›å»º Buffer.from

- ```js
  //Buffer çš„å£°æ˜åˆ›å»º
  const buf_1 = Buffer.alloc(10);
  const buf_2 = Buffer.allocUnsafe(10);
  const buf_3 = Buffer.from("yunmu");
  ```

##### Buffer è¯»å–å’Œå†™å…¥

å¯ä»¥ç›´æ¥é€šè¿‡ `[]` çš„æ–¹å¼å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨ toString æ–¹æ³•å°† Buffer è¾“å‡ºä¸ºå­—ç¬¦ä¸²

- ==[ ]== å¯¹ buffer è¿›è¡Œè¯»å–å’Œè®¾ç½®

- ```js
  //è·å–ç¬¬ä¸€ä¸ªå­—èŠ‚çš„å†…å®¹  121 å¯¹åº”çš„å­—ç¬¦æ˜¯å¤šå°‘
  console.log(buf_3[0]);
  //1. é€šè¿‡æ•°å­—è·å–å¯¹åº”çš„ ASCII å­—ç¬¦
  console.log(String.fromCharCode(121));
  //2. é€šè¿‡ ASCII å­—ç¬¦è·å–å¯¹åº”çš„ç¼–å·
  console.log("a".charCodeAt());
  //è®¾ç½®
  buf_3[0] = 99;
  console.log(buf_3.toString());
  ```

- ==toString== å°† Buffer è½¬åŒ–ä¸ºå­—ç¬¦ä¸²

- ```js
  //å°† Buffer è½¬åŒ–æˆå­—ç¬¦ä¸²
  console.log(buf_3.toString());
  ```

##### å…³äºæº¢å‡º

æº¢å‡ºçš„é«˜ä½æ•°æ®ä¼šèˆå¼ƒ

```js
//å…³äºæº¢å‡º   èˆå¼ƒé«˜äº 8 ä½çš„å†…å®¹  â€­0001 0010 1100â€¬  =>  0010 1100â€¬
buf_3[0] = 300;
console.log(buf_3.toString());
```

##### å…³äºä¸­æ–‡

ä¸€ä¸ª UTF-8 çš„ä¸­æ–‡å­—ç¬¦å¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯å  3 ä¸ªå­—èŠ‚

```js
//å…³äºä¸­æ–‡ ä¸€ä¸ªUTF-8ä¸­æ–‡å­—ç¬¦å æ®ä¸‰ä¸ªå­—èŠ‚
const buf_4 = Buffer.from("æˆ‘çˆ±ä½ ");
console.log(buf_4);
```

##### å…³äºå•ä½æ¢ç®—

1Bit å¯¹åº”çš„æ˜¯ 1 ä¸ªäºŒè¿›åˆ¶ä½

8 Bit = 1 å­—èŠ‚ï¼ˆByteï¼‰

1024Byte = 1KB

1024KB = 1MB

1024MB = 1GB

1024GB = 1TB

å¹³æ—¶æ‰€è¯´çš„ç½‘é€Ÿ 10M 20M 100M è¿™é‡ŒæŒ‡çš„æ˜¯ Bit ï¼Œæ‰€ä»¥ç†è®ºä¸‹è½½é€Ÿåº¦ é™¤ä»¥ 8 æ‰æ˜¯æ­£å¸¸çš„ç†è§£çš„ä¸‹è½½é€Ÿåº¦

### æ–‡ä»¶ç³»ç»Ÿ fs

fs å…¨ç§°ä¸º file systemï¼Œæ˜¯ NodeJS ä¸­çš„å†…ç½®æ¨¡å—ï¼Œå¯ä»¥å¯¹è®¡ç®—æœºä¸­çš„æ–‡ä»¶è¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚

##### æ–‡ä»¶å†™å…¥

> å¦‚æœè¦åšæœåŠ¡, éœ€è¦ä½¿ç”¨ã€å¼‚æ­¥ã€
> å¦‚æœåšæ–‡ä»¶ç›¸å…³çš„å¤„ç†, ä¸æ¶‰åŠä¸ºç”¨æˆ·æä¾›æœåŠ¡, å¯ä»¥ä½¿ç”¨åŒæ­¥ API(ç®€å•å†™å…¥, è¯»å–)
>
> å†™å…¥æ–‡ä»¶åœºæ™¯ï¼Œ éœ€è¦æŒä¹…åŒ–ä¿å­˜æ•°æ®çš„æ—¶å€™, éœ€è¦æƒ³åˆ°æ–‡ä»¶å†™å…¥
>
> 1. ä¸‹è½½æ–‡ä»¶
> 2. å®‰è£…æ–‡ä»¶
> 3. æ—¥å¿—(ç¨‹åºæ—¥è®°) å¦‚ Git
> 4. æ•°æ®åº“
> 5. ç½‘ç›˜
> 6. ç¼–è¾‘å™¨ä¿å­˜æ–‡ä»¶
> 7. è§†é¢‘å½•åˆ¶

- ç®€å•å†™å…¥

  - fs.writeFile(file, data, [,options], callback);

  - fs.writeFileSync(file, data);

  - options é€‰é¡¹

    - `encoding` **é»˜è®¤å€¼:** `'utf8'`
    - `mode`**é»˜è®¤å€¼:** `0o666`
    - `flag` **é»˜è®¤å€¼:** `'w'`

    ```js
    const fs = require("fs");

    // å¼‚æ­¥å†™å…¥
    fs.writeFile("./index.html", "äº‘ç‰§å¤§å¸…é¸½\r\n", { flag: "a" }, (err) => {
      if (err) {
        console.log("å†™å…¥å¤±è´¥", err);
        return;
      }
      console.log("å†™å…¥æˆåŠŸ");
    });
    // flagæ ‡è®°
    //   r   read  åªè¯»
    //   w   write å¯å†™
    //   a   append  è¿½åŠ 

    // åŒæ­¥å†™å…¥
    fs.writeFileSync("./app.css", "*{margin:0;padding:0}");
    fs.writeFileSync("./app.js", Date.now());

    // 0o666 Linux ä¸‹æ–‡ä»¶æƒé™çš„ç®¡ç†æ–¹å¼
    //   6 æ‰€æœ‰è€…çš„æƒé™
    //   6 æ‰€å±ç»„çš„æƒé™
    //   6 å…¶ä»–äººæƒé™

    // 6 æ€ä¹ˆæ¥çš„ 4 + 2
    //   4 å¯è¯»
    //   2 å¯å†™
    //   1 å¯æ‰§è¡Œ
    ```

å†™å…¥ç»ƒä¹ 

```js
let data = {
  id: 4860,
  uuid: "5e398eef-f5cf-4ff6-a000-c24913de86dd",
  hitokoto: "ä¸–ä¸Šæ‰€ä»¥ä¸å…¬å¹³ä¹‹äº‹æ˜¯ç”±äºå½“äº‹äººèƒ½åŠ›ä¸è¶³æ‰€è‡´ã€‚",
  type: "a",
  from: "é‡‘æœ¨ç ”",
  from_who: null,
  creator: "å¤•ä¹‹æ ‘",
  creator_uid: 4248,
  reviewer: 4756,
  commit_from: "web",
  created_at: "1573331301",
  length: 22,
};

//å°† JS å¯¹è±¡è½¬åŒ–ä¸º å­—ç¬¦ä¸²
let str = JSON.stringify(data);

//D:/data.txt
//1. å¼•å…¥ fs æ¨¡å—
const fs = require("fs");
//2. è°ƒç”¨æ–¹æ³•
fs.writeFile("d:/data.json", str, function (err) {
  if (err) {
    console.log("å†™å…¥å¤±è´¥");
    return;
  }
  console.log("å†™å…¥æˆåŠŸ");
});
```

- æµå¼å†™å…¥

  - fs.createWriteStream(path[, options])
    - path
    - options
      - ==flags== **é»˜è®¤å€¼:** `'w'`
      - `encoding `**é»˜è®¤å€¼:** `'utf8'`
      - `mode` **é»˜è®¤å€¼:** `0o666`
    - äº‹ä»¶ç›‘å¬ open close eg: ws.on('open', function(){});

  ```js
  //1. å¼•å…¥ fs æ¨¡å—
  const fs = require("fs");

  //2. åˆ›å»ºå†™å…¥æµå¯¹è±¡
  const ws = fs.createWriteStream("./home.html");
  const ws = fs.createWriteStream("./home.js");

  //3. æ‰§è¡Œå†™å…¥
  ws.write("<html>");
  ws.write(`
      <head>
          <title>è¿™æ˜¯ä¸€ä¸ªè„šæœ¬åˆ›å»ºçš„æ–‡ä»¶å“¦</title>
      </head>
      <body>
          <h1>å“å‘¦ ä¸é”™å“¦~</h1>
      </body>
  `);
  ws.write("</html>");

  ws.write(`
      const body = document.body;
      body.style.background = 'pink';
      setTimeout(() => {
          alert('æ­å–œä¸­å¥–å•¦!!!');
      }, 1000);
  `);

  //4. å…³é—­å†™å…¥æµ
  ws.close();
  //å¯¹äºç®€å•çš„å†™å…¥æ¬¡æ•°è¾ƒå°‘çš„æƒ…å†µ, å¯ä»¥ä½¿ç”¨ writeFile , å¦‚æœæ˜¯æ‰¹é‡è¦å†™å…¥çš„åœºæ™¯,ä½¿ç”¨ createWriteStream
  ```

##### æ–‡ä»¶è¯»å–

> **è¯»å–æ–‡ä»¶åœºæ™¯**
>
> 1. ä¸‹è½½æ–‡ä»¶
> 2. ç¨‹åºè¿è¡Œ
> 3. æ•°æ®è¯»å–(æ•°æ®åº“)
> 4. æ—¥å¿— (git log)
> 5. ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶

- ç®€å•è¯»å–

  - fs.readFile(file, function(err, data){})
  - fs.readFileSync(file)

  ```js
  //1. å¼•å…¥ fs æ¨¡å—
  const fs = require("fs");

  //2-1. è°ƒç”¨æ–¹æ³•è¯»å–å†…å®¹
  fs.readFile("./home.html", (err, data) => {
    if (err) {
      console.log("è¯»å–å¤±è´¥,é”™è¯¯çš„å¯¹è±¡ä¸º", err);
      return;
    }
    //è¾“å‡ºä»æ–‡ä»¶ä¸­è¯»å–çš„å†…å®¹ è¯»å–ç»“æœæ˜¯Buffer
    console.log(data.toString());
  });

  //2-2 åŒæ­¥è¯»å–
  let result = fs.readFileSync("./index.html");
  console.log(result.toString());
  ```

ç»ƒä¹ 

```js
//1. å¼•å…¥ fs æ¨¡å—
const fs = require("fs");

//2. è°ƒç”¨æ–¹æ³• ./index.html
fs.readFile("C:\\Windows\\Boot\\BootDebuggerFiles.ini", (err, data) => {
  //åˆ¤æ–­  throw æŠ›å‡º
  if (err) throw err;
  //è¾“å‡ºæ–‡ä»¶çš„å†…å®¹
  console.log(data.toString());
});
```

- æµå¼è¯»å–

  - fs.createReadStream();

  ```js
  //1. å¼•å…¥ fs æ¨¡å—
  const fs = require("fs");

  //2. åˆ›å»ºè¯»å–æµå¯¹è±¡
  const rs = fs.createReadStream("./file/åˆ»æ„ç»ƒä¹ .mp3");

  // è¯»å–æµæ‰“å¼€çš„æ—¶å€™è§¦å‘
  rs.on("open", () => {
    console.log("è¯»å–æµæ‰“å¼€äº†");
  });

  //3. ç»‘å®šäº‹ä»¶ when å½“....æ—¶å€™   chunk å—   å½“è¯»å–å®Œä¸€å—æ•°æ®å è§¦å‘
  rs.on("data", (chunk) => {
    console.log(chunk.length);
  });

  //readFile ä¸ createReadStream
  //å¯¹äºå°æ–‡ä»¶è¯»å–å’Œå¤„ç† readFile
  //å¯¹äºå¤§æ–‡ä»¶è¯»å– createReadStream
  ```

æµå¼è¯»å–æ–‡ä»¶å¹¶å†™å…¥

```js
//å¤åˆ¶æ–‡ä»¶
//1. æ¨¡å—å¼•å…¥
const fs = require("fs");

//2. åˆ›å»ºæµå¯¹è±¡
const rs = fs.createReadStream("./file/åˆ»æ„ç»ƒä¹ .mp3");
const ws = fs.createWriteStream("./file/ä¸äºŒæ³•é—¨.mp3");

//3. ç»‘å®šäº‹ä»¶è¯»å–å†…å®¹
// rs.on("data", (chunk) => {
//   //å†™å…¥æ–‡ä»¶
//   ws.write(chunk);
// });

//pipeç®¡é“ä¹Ÿå¯ä»¥å®Œæˆå†™å…¥
rs.pipe(ws);
```

##### æ–‡ä»¶åˆ é™¤

- fs.unlink('./test.log', function(err){});
- fs.unlinkSync('./move.txt');

```js
//1. å¼•å…¥ fs æ¨¡å—
const fs = require("fs");

//2. è°ƒç”¨æ–¹æ³•
fs.unlink("./project/index.js", (err) => {
  if (err) throw err;
  console.log("åˆ é™¤æˆåŠŸ");
});

fs.unlinkSync("./project/app.js");
```

##### ç§»åŠ¨æ–‡ä»¶ + é‡å‘½å

- fs.rename("oldPath", "newPath", function(err){})
- fs.renameSync("oldPath" ,"newPath")

```js
// 1. å¼•å…¥æ¨¡å—
const fs = require("fs");

//2. è°ƒç”¨æ–¹æ³•
fs.rename("./home.js", "./index.js", (err) => {
  if (err) throw err;
  console.log("é‡å‘½åæˆåŠŸ");
});

fs.rename("./index.html", "./project/é¦–é¡µ.html", (err) => {
  if (err) throw err;
  console.log("é‡å‘½åæˆåŠŸ");
});

//åŒæ­¥API
fs.renameSync("./project/app.css", "./project/index.css");
```

##### æ–‡ä»¶å¤¹æ“ä½œ

- mkdir åˆ›å»ºæ–‡ä»¶å¤¹
  - path
  - options
    - recursive æ˜¯å¦é€’å½’è°ƒç”¨
    - mode æƒé™ é»˜è®¤ä¸º 0o777
  - callback
- rmdir åˆ é™¤æ–‡ä»¶å¤¹
- readdir è¯»å–æ–‡ä»¶å¤¹

```js
//æ–‡ä»¶å¤¹æ“ä½œ
const fs = require("fs");

//åˆ›å»ºæ–‡ä»¶å¤¹
fs.mkdir("./html", (err) => {
  if (err) throw err;
  console.log("åˆ›å»ºæˆåŠŸ");
});

//è¯»å–æ–‡ä»¶å¤¹ read è¯»å–  dir æ–‡ä»¶å¤¹
fs.readdir("./project", (err, files) => {
  if (err) throw err;
  //è¾“å‡ºæ–‡ä»¶å¤¹ä¸‹çš„ã€æ–‡ä»¶åˆ—è¡¨ã€
  console.log(files);
});

fs.readdir("d:/", (err, files) => {
  if (err) throw err;
  //è¾“å‡ºæ–‡ä»¶å¤¹ä¸‹çš„ã€æ–‡ä»¶åˆ—è¡¨ã€
  console.log(files);
});

//åˆ é™¤æ–‡ä»¶å¤¹
fs.rmdir("./project", { recursive: true }, (err) => {
  console.log(err);
});
```

##### è·¯å¾„é—®é¢˜

> fs æ¨¡å—ä¸­çš„ç›¸å¯¹è·¯å¾„ å‚ç…§çš„æ˜¯æ‰§è¡Œå‘½ä»¤æ—¶çš„å·¥ä½œç›®å½•
>
> è·¯å¾„çš„åˆ†ç±»
>
> ç»å¯¹è·¯å¾„
>
> D:/www/share/day05/ä»£ç /1-nodejs/write.js (windows)
>
> C:/images/logo.png (windows)
>
> /usr/root/www/website/index.html (linux)
>
> ç›¸å¯¹è·¯å¾„
>
> ./index.html
>
> ../css/app.css ä¸Šä¸€çº§ç›®å½•ä¸­æ‰¾ css/app.css
>
> index.html å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„ index.html

```js
const fs = require("fs");
//ç‰¹æ®Šçš„å˜é‡  ã€å§‹ç»ˆä¿å­˜çš„æ˜¯å½“å‰æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„ã€
console.log(__dirname);
fs.writeFileSync(__dirname + "/index.html", "abc");
```

##### æŸ¥çœ‹ã€èµ„æºçš„çŠ¶æ€ã€

- stat(path, callback)

```js
const fs = require("fs");

//æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€
fs.stat("./file", (err, stats) => {
  if (err) throw err;
  //å¦‚æœæ²¡æœ‰é”™
  console.log("æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹" + stats.isDirectory());
  console.log("æ˜¯å¦ä¸ºæ–‡ä»¶" + stats.isFile());
});
```
